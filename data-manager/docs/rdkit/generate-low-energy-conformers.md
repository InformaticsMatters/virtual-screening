This describes how to run the *generate-low-energy-conformers* job from the *virtual screening* category in the *im-virtual-screening* collection.

## What the job does

This job generates a multiple energy minimised 3D conformers of molecules provided as SMILES input. It is typically used
to generate input for shape similarity screening using USR and it's derivatives.

The conformers are generated using RDKit's ETKDG conformer generator and energy minimised using the MMFF94 force field.
The basics are described [here](http://rdkit.org/docs/GettingStartedInPython.html#working-with-3d-molecules)

The number of conformers generated is based on the rules defined in Ejeber *et al.* J. Chem. Inf. Model. 2012, 52, 1146-1158
[doi:abs/10.1021/ci2004658](https://pubs.acs.org/doi/abs/10.1021/ci2004658).
Following conformer generation the structures are energy minimised using the MMFF94 force field. Finally, conformers with
very low RMS differences are removed (keeping the lowest energy one).  Note that we use a different RMS threshold as the
default, 1.0 as opposed to 0.35 that is used in Ejeber *et al.*.

The input is a file containing the molecules that need conformer generation, typically generated by the 
[prep-enum-conf-lists](prep-enum-conf-lists.md) job. Each entry in that file identifies a molecule in the sharded data 
structure (`digest.json` where `digest` is the full sha256 digest) and it is expected that there is a `digest.smi` 
file present containing the enumerated forms that need conformers generated (the `digest.smi` file is generated by the 
[enumerate-candidates](enumerate-candidates.md) job).

The output is a `digest_le_confs.sdf` file in the sharded data structure for each input molecule (see the 
[shard](shard.md) job for details). Conformers are generated for the different enumerated forms of the molecule, and 
multiple conformers are generated for each form.

## Implementation details

This job is implemented as a [Nextflow](https://www.nextflow.io/) workflow.

Python module: [/le_conformers.py](). This module is also used by the [conformers-for-mol](conformers-for-mol.md) job.
Nextflow workflow: [/le_conformers.nf]()
Job definition: `jobs.generate-low-energy-conformers` in [/data-manager/rdkit.yaml]()

## How to run the job

### Inputs

**Molecules to process**: typically the *Filename for molecules needing 3D conformers* output of the
[prep-enum-conf-lists](prep-enum-conf-lists.md) job.
**Directory with sharded data**: the directory with the sharded data (typically `molecules/sha256`)

### Options

This job has no user definable options

### Outputs

Outputs are written to the *sharded molecule system*
with file names such as *sha256-digest*_le_confs.sdf. Multiple conformers of each enumerated form are written.

## Related topics

* [Description of the sharded molecule system](https://discourse.squonk.it/t/the-sharded-molecule-system/88)
* [filter job](filter.md)
* [prep-enum-conf-lists job](prep-enum-conf-lists.md)
* [enumerate-candidates job](enumerate-candidates.md)
* [assemble-conformers job](assemble-conformers.md)