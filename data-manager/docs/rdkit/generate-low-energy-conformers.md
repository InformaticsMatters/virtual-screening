# Job: generate-low-energy-conformers

This describes how to run the `generate-low-energy-conformers` job from the `virtual screening` category in the `im-virtual-screening` collection.

## What the job does

This job generates a multiple energy minimised 3D conformers of molecules provided as SMILES of SDF input.
It is typically used to generate input for shape similarity screening using USR and it's derivatives.

The conformers are generated using RDKit's ETKDG conformer generator and energy minimised using the MMFF94 force field.
The basics are described [here](http://rdkit.org/docs/GettingStartedInPython.html#working-with-3d-molecules)

The number of conformers generated is based on the rules defined in Ejeber *et al.* J. Chem. Inf. Model. 2012, 52, 1146-1158
[doi:abs/10.1021/ci2004658](https://pubs.acs.org/doi/abs/10.1021/ci2004658).
Following conformer generation the structures are energy minimised using the MMFF94 force field. Finally, conformers with
very low RMS differences are removed (keeping the lowest energy one).  Note that we use a different RMS threshold as the
default, 1.0 as opposed to 0.35 that is used in Ejeber *et al.*.

The input is a file containing the molecules that need conformer generation, typically generated by the
[enumerate-candidates](../im-virtual-screening/enumerate-candidates.md) job), but any SDF or SMILES file is also OK. 


## Implementation details

* Python module: [le_conformers.py](/le_conformers.py). This module is also used by the [conformers-for-mol](conformers-for-mol.md) job.
* Job definition: `jobs.generate-low-energy-conformers` in [rdkit.yaml](/data-manager/rdkit.yaml)

## How to run the job

### Inputs

* **Molecules to process**: the input molecules.

### Options

* **Output file name**: the name of the SD-file with the enumerated structures.
* **Max number of conformers to generate**: the maximum number of conformers to generate (1)
* **Number of minimisation cycles**: the number of minimisation cycles to use (default 500) 
* **RMS threshold for excluding conformers**: conformers with less than this RMS are excluded (default 1.0)
* **Remove hydrogens from the outputs**: remove explicit hydrogens from the outputs
* **Input has header line**: input file (if delineated text) contains a header line with field names
* **Separator for text formats**: separator for input file (if delineated text)
* **idColumn**: column number (zero indexed, for delineated text) or field name (for SDF) with the molecule ID

Notes:

1. If the *Max number of conformers to generate* option is not specified then the Inhibox rules are used,
   which is based on the number or rotatable bonds: if <=7 then 50, if <= 12 then 200, else 300. Less than this will
   typically be generated as ones with very low RMS are excluded.

### Outputs

Outputs are written to a SD-file.

The following properties are added to the outputs:
* **ID**: the ID of the input molecule (specified using the * Index (text) or name (SDF) to use for the ID field* option)
* **CONF_NUM**: the conformer number
* **Energy**: the energy of the conformer
* **Energy_Delta**: the energy difference to the lowest energy conformer of the set of generated conformers for this 
  input molecule

The conformers are also given a unique title (ID), based on the ID (or input molecule number if no ID) and the 
conformer number.

## Related topics

* [enumerate-candidates job](../im-virtual-screening/enumerate-candidates.md)